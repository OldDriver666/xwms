<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>欢迎登录后台管理系统</title>
<link href="css/style.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="css/bootstrap.css"/>
<link rel="stylesheet" href="resource/plugin/toastr/toastr.css"/>
<script language="JavaScript" src="js/jquery.min.js"></script>

<script language="javascript">
	$(function(){
        $('.loginbox').css({'position':'absolute','left':($(window).width()-692)/2});
		$(window).resize(function(){
            $('.loginbox').css({'position':'absolute','left':($(window).width()-692)/2});
	    })
	});
</script> 
	<style type="text/css">
		#modal-loading{
			position: fixed;
			top: 0;
			right: 0;
			bottom: 0;
			left: 0;
			z-index: 2000;
			display: none;
			overflow: hidden;
			-webkit-overflow-scrolling: touch;
			outline: 0;
		}
		#modal-loading .modal-dialog{
			width: 120px;
			margin: 20% auto;
		}
		#modal-loading .modal-content{
			background-color: rgba(255,255,255,.9);
		}
	</style>
</head>

<body style="background-color:#1c77ac; background-image:url(images/light.png); background-repeat:no-repeat; background-position:center top; overflow:hidden;">

<div id="mainBody">
  <div id="cloud1" class="cloud"></div>
  <div id="cloud2" class="cloud"></div>
</div>

<!--<div class="logintop">
    <span>欢迎登录后台管理界面平台</span>    
    <ul>
	    <li><a href="#">回首页</a></li>
	    <li><a href="#">帮助</a></li>
	    <li><a href="#">关于</a></li>
    </ul>    
</div>-->
    
<div class="loginbody">
    <span class="systemlogo"></span>
    <div class="loginbox">
	    <form id="form-loginTempl">
		    <ul>
			    <li><input id="ipt_username" name="username" type="text" class="loginuser" placeholder="账号"/></li>
			    <li><input id="ipt_password" name="password" type="password" class="loginpwd" placeholder="密码"/></li>
			    <li>
				    <input id="btn_submit" type="button" class="loginbtn" value="登录"/>
				    <!--<label><input id="savePwd" type="checkbox" value=""/>记住密码</label>-->
				    <!--<label><a href="#">忘记密码？</a></label>-->
			    </li>
		    </ul>
	    </form>
    </div>
</div>

<!--<div class="loginbm">版权所有</div>-->

<div class="modal fade" id="modal-loading" tabindex="-1" role="dialog" aria-hidden="true">
	<div style="height: 100%;display: flex;justify-content: center;align-items: center;">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-body" style="text-align: center;"><img src="images/uploading.gif"><br>正在登录</div>
			</div>
		</div>
	</div>
</div>

<script type ="text/javascript" src="js/bootstrap.min.js"></script>
<script src="js/jquery.i18n.properties-min-1.0.9.js"></script>
<script type ="text/javascript" src="resource/plugin/toastr/toastr.min.js"></script>
<script src="js/Util.js"></script>
<script src="resource/lib/jquery.md5.js"></script>
<script src="js/json2.js"></script>
<!--<script src="js/cloud.js" type="text/javascript"></script>-->
<script>
window.onload = function() {
    toastr.options = {
        positionClass: 'toast-center-center',
        showDuration: "300",
        hideDuration: "300",
        timeOut: "1500"
    };
    $("#form-loginTempl").submit(function () {
        return false;
    });
    function login() {
        $("#modal-loading").modal({backdrop: 'static', keyboard: false, show: true});
        var url = ctx + "boss/admin/login";
        var data = {"account": $("#ipt_username").val(), "password": $.md5($("#ipt_password").val()) };
        Util.ajaxLoginData(url, data, "POST", true, function (result) {
            $("#modal-loading").modal("hide")
            if (result.code == ReturnCode.SUCCESS) {
                Util.cookieStorage.setCookie("accesstoken", result.data.accessToken);
                Util.cookieStorage.setCookie("username", result.data.account);
                Util.cookieStorage.setCookie("nickname", result.data.nickName);
                Util.cookieStorage.setCookie("userLevel", result.data.roleId);
                Util.cookieStorage.setCookie("companyId", result.data.companyId);
                Util.cookieStorage.setCookie("departId", result.data.departId);
                Util.cookieStorage.setCookie("adminId", result.data.id);
                Util.cookieStorage.setCookie("phone", result.data.phone);
                Util.cookieStorage.setCookie("home", result.data.home);
                window.location.href = result.data.home;
            } else {
                toastr.error(result.msg);
            }
        }, function () {
            $("#modal-loading").modal("hide")
            alert("服务器异常，请稍后重试！");
        });
    }

    $("#btn_submit").bind('click', function () {
        if ($("#ipt_username").val() === "") {
            toastr.error("用户名不能为空！");
            return;
        } else if ($("#ipt_password").val() === "") {
            toastr.error("密码不能为空！");
            return;
        } else {
            login();
        }
    });

    $("#ipt_password").on('keydown', function (e) {
        if (e.keyCode == 13) {
            if ($("#ipt_username").val() === "") {
                toastr.error("用户名不能为空！");
                return;
            } else if ($("#ipt_password").val() === "") {
                toastr.error("密码不能为空！");
                return;
            } else {
                login();
            }
        }
    });
}
</script>
</body>
</html>
