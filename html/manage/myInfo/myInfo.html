<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<title>修改密码</title>
	<link rel="stylesheet" href="../../css/bootstrap.css"/>

</head>

<body>
<div class="form-horizontal">
	<div class="form-group">
		<label class="col-sm-2 control-label">昵称：</label>
		<div class="col-sm-10" style="padding-top: 7px;">
			<span class="form-control-static nickName_txt"></span>
			<span id="btn-NickName" title="修改昵称" style="margin-left: 20px;border: 1px solid #ddd;padding: 2px 3px;cursor: pointer;border-radius: 4px;" data-toggle="modal" data-target="#NickName-modal">
				<span class="glyphicon glyphicon-pencil"></span>
			</span>
		</div>
	</div>
	<div class="form-group">
		<label class="col-sm-2 control-label">用户名：</label>
		<div class="col-sm-10">
			<p class="form-control-static userName_txt"></p>
		</div>
	</div>
	<div class="form-group">
		<label class="col-sm-2 control-label">密码：</label>
		<div class="col-sm-10" style="padding-top: 7px;">
			<span id="btn-editPW" title="修改密码" style="margin-left: 20px;border: 1px solid #ddd;padding: 2px 3px;cursor: pointer;border-radius: 4px;" data-toggle="modal" data-target="#editPW-modal">
				<span class="glyphicon glyphicon-pencil"></span>
			</span>
		</div>
	</div>
</div>

<!--<button id="btn-editPW" type="button" class="btn btn-default" data-toggle="modal" data-target="#editPW-modal">
	<span class="glyphicon glyphicon-pencil"> </span><span style="margin-left: 3px">修改密码</span>
</button>-->


<div class="modal fade" id="editPW-modal" tabindex="-1" role="dialog" aria-labelledby="editPW-modal-label" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title" id="editPW-modal-label">修改密码</h4>
			</div>
			<div class="modal-body">
				<form id="form-editPW" data-action="" class="form-horizontal">
					<input type="hidden" id="input-id">
					<div class="form-group">
						<label for="ipt_username" class="col-sm-2 control-label"><span class="necessary">*</span>用户名</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" id="ipt_username" name="username" placeholder="输入用户名">
						</div>
					</div>
					<div class="form-group">
						<label for="ipt_old_password" class="col-sm-2 control-label"><span class="necessary">*</span>旧密码</label>
						<div class="col-sm-10">
							<input type="password" class="form-control" id="ipt_old_password" name="password" placeholder="输入旧密码">
						</div>
					</div>
					<div class="form-group">
						<label for="ipt_new_password" class="col-sm-2 control-label"><span class="necessary">*</span>新密码</label>
						<div class="col-sm-10">
							<input type="password" class="form-control" id="ipt_new_password" name="confirmPassword" placeholder="输入新密码">
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="btn_submit" type="button" class="btn btn-primary">提交</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>

<div class="modal fade" id="NickName-modal" tabindex="-1" role="dialog" aria-labelledby="NickName-modal-label" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title" id="NickName-modal-label">修改昵称</h4>
			</div>
			<div class="modal-body">
				<form id="form-NickName" data-action="" class="form-horizontal">
					<div class="form-group">
						<label for="ipt_username" class="col-sm-2 control-label"><span class="necessary">*</span>昵称</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" id="ipt_nickname" name="nickname" placeholder="输入昵称">
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="btn_submit1" type="button" class="btn btn-primary">提交</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>




<script src="../../js/jquery.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/jquery.i18n.properties-min-1.0.9.js"></script>
<script src="../../js/Util.js"></script>
<script src="../../resource/lib/jquery.md5.js"></script>

<script>
$(function() {
    //获取cookie
    var nickName = Util.cookieStorage.getCookie("nickname");
    var userName = Util.cookieStorage.getCookie("username");
    var token_value = Util.cookieStorage.getCookie("accesstoken");
    $(".nickName_txt").text(nickName);
    $(".userName_txt").text(userName);

    $("#form_editPW, #form_NickName").submit(function (e) {
        return false;
    });

    //修改密码
    $("#btn_submit").bind('click', function (e) {
        var url = ctx + "Manage/ModifyPassword";
        var data = {
            "AuthenticCode": token_value,
            "UserName": userName,
            "Oldpassword": $.md5($("#ipt_old_password").val()),
            "Newpassword": $.md5($("#ipt_new_password").val())
        };

        Util.ajaxLoadData(url,data,"POST",true,function (result) {
            if (result.Status == ReturnCode.SUCCESS && result.AuthenticCode != "") {
                $("#editPW-modal").modal('hide');
                alert("修改完成！");
            } else {
                alert("账户名、密码或错误！");
            }
        },function () {
            alert("服务器开个小差，请稍后重试！")
        });
    });

    //修改昵称
    $("#btn_submit1").bind('click',function(e){
        var newNickName = $("#ipt_nickname").val();
        var url = ctx + "Manage/ModifyNickName";
        var data = {"AuthenticCode":token_value,"UserName":userName,"NewNickName":newNickName};

        Util.ajaxLoadData(url,data,"POST",true,function(result) {
            if(result.Status == ReturnCode.SUCCESS && result.AuthenticCode != ""){
                Util.cookieStorage.setCookie("nickname",newNickName);
                $(".nickName_txt").text(newNickName);
                $("#NickName-modal").modal('hide');
                alert("修改完成！");
            } else {
                alert("修改失败！");
            }
        },function() {
            alert("服务器开个小差，请稍后重试！")
        });
    });

});
</script>

</body>

</html>