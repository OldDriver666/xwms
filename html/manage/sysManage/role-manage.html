<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<title></title>
	<link rel="stylesheet" href="../../css/global.css"/>
	<link rel="stylesheet" href="../../css/bootstrap.css"/>
	<link rel="stylesheet" href="../../resource/plugin/toastr/toastr.css"/>
</head>

<body>
<div class="container-fluid">
	<div class="row">
		<div class="mod-body">
			<nav class="navbar navbar-default">
				<div class="container-fluid">

					<div class="navbar-form navbar-right">
						<button id="btn-add-userRoles" type="button" class="btn btn-default" data-toggle="modal" data-target="#addTempl2-modal">
							<span class="glyphicon glyphicon-plus"> </span><span style="margin-left: 3px">添加用户角色</span>
						</button>
					</div>


					<div class="modal fade" id="addTempl2-modal" tabindex="-1" role="dialog" aria-labelledby="addTempl-modal-label" aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
									<h4 class="modal-title" id="addTempl2-modal-label">添加/编辑用户角色</h4>
								</div>
								<div class="modal-body">
									<form id="form-addTempl2" data-action="" class="form-horizontal">
										<input type="hidden"  id="input-id">
										<div class="form-group">
											<label for="input-authLevel" class="col-sm-2 control-label"><span class="necessary">*</span>角色权值</label>
											<div class="col-sm-10">
												<input type="text" class="form-control" id="input-authLevel" name="authLevel" placeholder="请输入角色权值">
											</div>
										</div>
										<div class="form-group">
											<label for="input-name" class="col-sm-2 control-label"><span class="necessary">*</span>角色名称</label>
											<div class="col-sm-10">
												<input type="text" class="form-control" id="input-name" name="name" placeholder="请输入角色名称">
											</div>
										</div>
										<div class="form-group">
											<label for="input-description" class="col-sm-2 control-label"><span class="necessary"></span>角色描述</label>
											<div class="col-sm-10">
												<input type="text" class="form-control" id="input-description" name="description" placeholder="请输入角色描述">
											</div>
										</div>
										<div class="form-group" id="role-depart-txt-wrap">
											<label class="col-sm-2 control-label">角色部门</label>
											<div class="col-sm-10 form-txt">
												<input type="text" class="form-control" id="role-depart-txt" name="role-depart-txt" style="border: 0;background: #fff;box-shadow: none;-webkit-box-shadow: none;">
											</div>
										</div>
										<div class="form-group" id="role-departId-wrap">
											<label for="role-departId" class="col-sm-2 control-label"><span class="necessary"></span>角色部门</label>
											<div class="col-sm-10">
												<select name="role-departId" id="role-departId" class="form-control">
													<option value="">请选择角色的所属部门</option>
												</select>
											</div>
										</div>
										<div class="form-group" id="role-permission-txt-wrap">
											<label class="col-sm-2 control-label">角色权限</label>
											<div class="col-sm-10 form-txt">

												<div style="min-height: 36px;border:1px solid #ddd;" id="menuContent">
													<!--<div class="tree_content">
														<div class="tree_node">
															<div class="div_inline"><input type="button" value="+" class="tree_node_toggle_button"></div>
															<div class="div_inline tree_node_parent">
																<input type="checkbox" class="tree_node_parent_checkbox">父节点1
																<div class="tree_node_child" style="display:none;">
																	<div class="tree_node_child_menu">
																		<input type="checkbox" class="tree_node_child_checkbox">子节点1
																		<div class="tree_node_child_permission_wrap">
																			<span class="tree_node_child_permission"><input type="checkbox">添加</span>
																			<span class="tree_node_child_permission"><input type="checkbox">删除</span>
																			<span class="tree_node_child_permission"><input type="checkbox">修改</span>
																			<span class="tree_node_child_permission"><input type="checkbox">查询</span>
																		</div>
																	</div>
																	<div class="tree_node_child_menu">
																		<input type="checkbox" class="tree_node_child_checkbox">子节点点点2
																		<div class="tree_node_child_permission_wrap">
																			<span class="tree_node_child_permission"><input type="checkbox">添加</span>
																			<span class="tree_node_child_permission"><input type="checkbox">删除</span>
																			<span class="tree_node_child_permission"><input type="checkbox">修改</span>
																			<span class="tree_node_child_permission"><input type="checkbox">查询</span>
																		</div>
																	</div>
																	<div class="tree_node_child_menu">
																		<input type="checkbox" class="tree_node_child_checkbox">子节点点3
																		<div class="tree_node_child_permission_wrap">
																			<span class="tree_node_child_permission"><input type="checkbox">添加</span>
																			<span class="tree_node_child_permission"><input type="checkbox">删除</span>
																			<span class="tree_node_child_permission"><input type="checkbox">修改</span>
																			<span class="tree_node_child_permission"><input type="checkbox">查询</span>
																		</div>
																	</div>
																</div>
															</div>
														</div>
														<div class="tree_node">
															&lt;!&ndash; 切换子目录隐藏或显示的按钮 &ndash;&gt;
															<div class="div_inline"><input type="button" value="+" class="tree_node_toggle_button"></div>
															<div class="div_inline tree_node_parent">
																<input type="checkbox" class="tree_node_parent_checkbox">父节点2
																<div class="tree_node_child" style="display:none;">
																	<input type="checkbox" class="tree_node_child_checkbox">子节点1<br>
																</div>
															</div>
														</div>
														<div class="tree_node">
															<div class="div_inline"><input type="button" value="+" class="tree_node_toggle_button"></div>
															<div class="tree_node_parent div_inline">
																<input type="checkbox" class="tree_node_parent_checkbox">父节点3
																<div class="tree_node_child" style="display:none;">
																	<input type="checkbox" class="tree_node_child_checkbox">子节点1<br>
																	<input type="checkbox" class="tree_node_child_checkbox">子节点2<br>
																	<input type="checkbox" class="tree_node_child_checkbox">子节点3<br>
																</div>
															</div>
														</div>
													</div>-->
												</div>

											</div>
										</div>
									</form>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
									<button id="btn-add-submit2" type="button" class="btn btn-primary">提交</button>
								</div>
							</div><!-- /.modal-content -->
						</div><!-- /.modal -->
					</div>


				</div>
			</nav>
			<table id="table" class="table table-striped table-hover">
				<thead>
				<tr>
					<th>角色ID</th>
					<th>角色权值</th>
					<th>角色名称</th>
					<th>描述</th>
					<th>所属公司</th>
					<th>所属部门</th>
					<th class="table-manage">管理</th>
				</tr>
				</thead>
				<tbody id="pageContent"></tbody>
			</table>
		</div>
	</div>
</div>


<script type ="text/javascript" src="../../js/jquery.min.js"></script>
<script type ="text/javascript" src="../../js/bootstrap.min.js"></script>
<script type ="text/javascript" src="../../js/jquery.tmpl.js"></script>
<script type ="text/javascript" src="../../resource/plugin/toastr/toastr.min.js"></script>
<script type ="text/javascript" src="../../js/Util.js"></script>
<script src="../../resource/lib/jquery.md5.js"></script>
<script type ="text/javascript" src="js/role-manage.js"></script>
<!-- jQuery Validate -->
<script type ="text/javascript" src="../../resource/plugin/jquery.validate-1.14.0/jquery.validate.min.js"></script>
<script type ="text/javascript" src="../../resource/plugin/jquery.validate-1.14.0/additional-methods.min.js"></script>
<script type ="text/javascript" src="../../resource/plugin/jquery.validate-1.14.0/jquery.validate.extend.js"></script>
<script type="text/x-jquery-tmpl" id="pageTmpl">
<tr>
	<td>${id}</td>
	<td>${authLevel}</td>
	<td>${role_name}</td>
	<td>${desc}</td>
	<td>${companyNameQuery(companyId)}</td>
	<td>${departNameQuery(departId)}</td>
	<td class="table-update">
	   <a href="javascript:void(0);" class="table-edit-btn">编辑</a>
	   <a href="javascript:void(0);" onclick="action.deleteItem(${id},'${name}')">删除</a>
	</td>
</tr>
</script>
<script type="text/x-jquery-tmpl" id="pageUserRoles">
    <option value=${id}>${departName}</option>
</script>
<script type="text/javascript">
    var departArray = JSON.parse(localStorage.getItem("departArray"));
    if (departArray != null) {
        var Lens1 = departArray.length;
        function departNameQuery(id) {
            for (var i = 0; i < Lens1; i++) {
                if (departArray[i].id === id) {
                    return departArray[i].departName;
                } else if (id === 0) {
                    return '0'
                }
            }
        }
    }
    var allCompanyArray = JSON.parse(localStorage.getItem("allCompanyArray"));
    if (allCompanyArray != null){
        var Lens2 = allCompanyArray.length;
        function companyNameQuery(type){
            for(var i=0; i< Lens2; i++){
                if(allCompanyArray[i].id == type){
                    return allCompanyArray[i].name;
                }
            }
        }
	}

	toastr.options={
	    positionClass : 'toast-center-center',
        showDuration: "300",
        hideDuration: "300",
        timeOut: "1000"
    };
</script>

<script type="text/x-jquery-tmpl" id="pageMenu">
<div class="tree_content">
	<div class="tree_node">
		<div class="div_inline"><input type="button" value="+" class="tree_node_toggle_button"></div>
		<div class="div_inline tree_node_parent">
			<input type="checkbox" class="tree_node_parent_checkbox" value="${module_id}" checked="true">${module_name}
			<div class="tree_node_child" style="display:none;">
				{{each(i,item) children}}
				<div class="tree_node_child_menu">
					<input type="checkbox" class="tree_node_child_checkbox" value="${item.module_id}" checked="true">${item.module_name}
					<div class="tree_node_child_permission_wrap">
						<span class="tree_node_child_permission"><input type="checkbox" class="prem_query" checked="true">查询</span>
						<span class="tree_node_child_permission"><input type="checkbox" class="prem_add" checked="true">添加</span>
						<span class="tree_node_child_permission"><input type="checkbox" class="prem_update" checked="true">修改</span>
						<!--<span class="tree_node_child_permission"><input type="checkbox" class="prem_del" checked="true">删除</span>-->
					</div>
				</div>
				{{/each}}
			</div>
		</div>
	</div>
</div>
</script>

<script>
    //树形复选框
    // 页面加载完成后调用
    $(function(){

        // 为所有的父节点添加点击事件
        $("#menuContent").on('click','.tree_node_parent_checkbox',function(){
            // 获取父节点是否选中
            var isChange = $(this).prop("checked");
            if(isChange){
                $(this).parent().find("input").prop("checked", true);
            }else{
                $(this).parent().find("input").removeAttr("checked");
            }
        });

        // 为所有的子节点添加点击事件
        $("#menuContent").on('click','.tree_node_child_checkbox',function () {
            // 获取选中的节点的父节点下的所有子节点选中的数量
            var length=$(this).parent().parent().find(".tree_node_child_checkbox:checked").length;
            // 判断当前结点是否选中
            if($(this).prop("checked")){ // 选中
                $(this).parent().find("input").prop("checked", true);
                // 如果当前节点选中后,所有的选中节点数量1，选中父节点
                if(length >= 1){
                    $(this).parent().parent().parent().find(".tree_node_parent_checkbox").prop("checked", true);
                }
            }else{ // 节点未选中
                $(this).parent().find("input").removeAttr("checked");
                if(length < 1){
                    // 取消父节点的选中状态
                    $(this).parent().parent().parent().find(".tree_node_parent_checkbox").removeAttr("checked");
                }
            }
        });

		// 为所有的子节点中的增删改查添加点击事件
        $("#menuContent").on('click','.tree_node_child_permission_wrap input',function () {
            // 获取选中的节点的父节点下的所有子节点选中的数量
            var length2=$(this).parent().parent().find("input:checked").length;
            // 判断当前结点是否选中
            if($(this).prop("checked")){ // 选中
                // 如果当前节点选中后,所有的选中节点数量1，选中父节点
                if(length2 >= 1){
                    $(this).parent().parent().parent().find(".tree_node_child_checkbox").prop("checked", true);
                }
            }else{ // 节点未选中
                if(length2 < 1){
                    // 取消父节点的选中状态
                    $(this).parent().parent().parent().find(".tree_node_child_checkbox").removeAttr("checked");
                }
            }
        })

        // 为所有的切换按钮添加点击事件
        $("#menuContent").on('click','.tree_node_toggle_button',function () {
            // 获取需要隐藏或显示的节点
            var $toggle_node = $(this).parent().next().find(".tree_node_child");
            $toggle_node.toggle(); // 切换隐藏或显示
            // 切换按钮的显示
            if($toggle_node.is(":visible")){
                $(this).val("-");
            }else{
                $(this).val("+");
            }
        });
    });
</script>
</body>
</html>